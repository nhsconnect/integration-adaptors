version: '3'

services:
  route:
    build: ./integration-tests/fake_spineroutelookup

  fakespine:
    build: ./integration-tests/fake_spine
    ports:
      - "6061:443"
    environment: 
      - FAKE_SPINE_CERTIFICATE
      - FAKE_SPINE_PRIVATE_KEY
      - FAKE_SPINE_CA_STORE

  inbound:
    environment:
      - MHS_SECRET_CLIENT_CERT=${INBOUND_CERTIFICATE}
      - MHS_SECRET_CLIENT_KEY=${INBOUND_PRIVATE_KEY}
      - MHS_SECRET_CA_CERTS=${INBOUND_CA_STORE}

  outbound:
    environment:
      - MHS_SECRET_CLIENT_CERT=${OUTBOUND_CERTIFICATE}
      - MHS_SECRET_CLIENT_KEY=${OUTBOUND_PRIVATE_KEY}
      - MHS_SECRET_CA_CERTS=${OUTBOUND_CA_STORE}